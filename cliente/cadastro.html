<!DOCTYPE html>
<html lang="pt-br">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Cadastrar Carro</title>

   <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

   <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-light">

   <nav class="p-3 bg-dark text-white">
       <a href="index.html" class="text-white m-2">Início</a>
       <a href="cadastro.html" class="text-white m-2">Cadastrar Carro</a>
   </nav>

   <div id="app" class="container mt-4">

       <div class="card shadow p-4">

           <h2 class="mb-4">Cadastrar Carro</h2>

           <div class="mb-3">
               <label class="form-label">Marca</label>
               <input type="text" class="form-control" v-model="marca">
           </div>

           <div class="mb-3">
               <label class="form-label">Modelo</label>
               <input type="text" class="form-control" v-model="modelo">
           </div>

           <div class="mb-3">
               <label class="form-label">Ano</label>
               <input type="number" class="form-control" v-model="ano">
           </div>

           <div class="mb-3">
               <label class="form-label">Preço</label>
               <input type="number" class="form-control" v-model="preco">
           </div>

           <div class="mb-3">
               <label class="form-label">Foto do Carro</label>
               <input type="file" class="form-control" @change="pegarFoto">
           </div>

           <button class="btn btn-success w-100" @click="enviar">
               Salvar Carro
           </button>

           <p class="text-success mt-3" v-if="mensagem">{{ mensagem }}</p>

       </div>

   </div>


   <script>
   const { createApp, ref } = Vue

   createApp({
       setup() {

           const marca = ref("")
           const modelo = ref("")
           const ano = ref("")
           const preco = ref("")
           const foto = ref(null)
           const mensagem = ref("")

           function pegarFoto(evento) {
               foto.value = evento.target.files[0]
           }

           async function enviar() {
               const formData = new FormData()

               formData.append("marca", marca.value)
               formData.append("modelo", modelo.value)
               formData.append("ano", ano.value)
               formData.append("preco", preco.value)

               if (foto.value) {
                   formData.append("foto", foto.value)
               }

               try {
                   await axios.post("http://127.0.0.1:8000/carros/", formData, {
                       headers: {
                           "Content-Type": "multipart/form-data"
                       }
                   })

                   mensagem.value = "Carro cadastrado com sucesso!"

                   marca.value = ""
                   modelo.value = ""
                   ano.value = ""
                   preco.value = ""
                   foto.value = null

               } catch (erro) {
                   mensagem.value = "Erro ao enviar o carro."
               }
           }

           return {
               marca,
               modelo,
               ano,
               preco,
               mensagem,
               pegarFoto,
               enviar
           }
       }
   }).mount('#app')
   </script>

</body>
</html>
