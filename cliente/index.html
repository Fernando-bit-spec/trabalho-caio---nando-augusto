<!DOCTYPE html>
<html lang="pt-br">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Concessionária</title>

   <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

   <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

   <nav class="p-3 bg-dark text-white">
       <a href="index.html" class="text-white m-2">Início</a>
       <a href="cadastro.html" class="text-white m-2">Cadastrar Carro</a>
   </nav>

   <div id="app" class="container mt-4">

       <div v-for="(carro, index) in carros" class="card m-2 p-4 shadow">

           <h3 class="card-title">{{ carro.marca }} - {{ carro.modelo }}</h3>
           <small class="card-subtitle text-muted">{{ carro.ano }}</small>

           <!-- ADICIONADO: DATA FORMATADA -->
           <small class="text-muted d-block">
               Cadastrado em: {{ formatarData(carro.criado_em) }}
           </small>

           <img v-if="carro.foto" :src="carro.foto" class="img-fluid my-3 rounded">

           <div v-if="!carro.editando">
               <p class="card-body fs-5">Preço: R$ {{ carro.preco }}</p>

               <button class="btn btn-primary" 
                       @click="carro.editando = true">
                       Editar
               </button>

               <button class="btn btn-danger m-2"
                       @click="axios.delete(carro.url); carros.splice(index, 1)">
                       Apagar
               </button>
           </div>

           <div v-else>
               <div class="mb-2">
                   <label>Marca</label>
                   <input class="form-control" v-model="carro.marca">
               </div>

               <div class="mb-2">
                   <label>Modelo</label>
                   <input class="form-control" v-model="carro.modelo">
               </div>

               <div class="mb-2">
                   <label>Ano</label>
                   <input class="form-control" v-model="carro.ano">
               </div>

               <div class="mb-2">
                   <label>Preço</label>
                   <input class="form-control" v-model="carro.preco">
               </div>

               <button class="btn btn-success" 
                       @click="carro.editando = false; axios.put(carro.url, carro)">
                       Salvar
               </button>

               <button class="btn btn-secondary m-2"
                       @click="carro.editando = false">
                       Cancelar
               </button>
           </div>

       </div>
   </div>

   <div id="carregaMais" class="text-center p-4">Carregando...</div>


   <script>
   const { createApp, ref } = Vue

   createApp({
       setup() {
       const carros = ref([])

       let url = 'http://127.0.0.1:8000/carros/'   // ← URL da API

       async function getCarros() {
           if (url) {
               const res = await axios.get(url)
               carros.value = [...carros.value, ...res.data.results]

               carros.value = carros.value.map(c => ({ ...c, editando:false }))

               url = res.data.next
           }
       }

       // ADICIONADO: função para formatar a data
       function formatarData(data) {
           const d = new Date(data)
           return d.toLocaleDateString("pt-BR") + " " + d.toLocaleTimeString("pt-BR")
       }

       const observador = new IntersectionObserver((entries) => {
           if (entries.every(e => e.isIntersecting)) {
               getCarros()
           }
       })

       observador.observe(carregaMais)

       return {
           carros,
           axios,
           formatarData   // ← ADICIONADO AQUI
       }
       }
   }).mount('#app')
   </script>

</body>
</html>
